name: æµ‹è¯•æ„å»ºæ–‡æ¡£

on:
  push:
    branches: [ main ]
    tags-ignore:
      - '**'  # å¿½ç•¥æ‰€æœ‰æ ‡ç­¾æ¨é€ï¼Œé¿å…ä¸åŸºäºæ ‡ç­¾çš„éƒ¨ç½²å†²çª
    paths:
      - '**'
      - '.github/workflows/deploy-docs.yml'
  pull_request:
    branches: [ main ]
    paths:
      - '**'
  repository_dispatch:
    types: [docs-updated]

# è®¾ç½®æƒé™ä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# åªå…è®¸ä¸€ä¸ªå¹¶å‘éƒ¨ç½²ï¼Œè·³è¿‡æ­£åœ¨è¿›è¡Œçš„è¿è¡Œä¹‹é—´æ’é˜Ÿçš„è¿è¡Œã€‚
# ä½†æ˜¯ï¼Œä¸è¦å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›è®©è¿™äº›ç”Ÿäº§éƒ¨ç½²å®Œæˆã€‚
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºä½œä¸š
  build:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–å®Œæ•´å†å²è®°å½•ä»¥ä¾¿ Docusaurus å¯ä»¥è®¡ç®—æœ€åä¿®æ”¹æ—¶é—´

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: ./package-lock.json

      - name: å®‰è£…ä¾èµ–
        run: npm ci

      - name: æ„å»ºç½‘ç«™
        run: npm run build

      - name: è®¾ç½® Pages
        uses: actions/configure-pages@v4

      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./build

  # æµ‹è¯•æ„å»ºå®Œæˆé€šçŸ¥
  test-complete:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' && !startsWith(github.ref, 'refs/tags/')
    steps:
      - name: æ„å»ºæµ‹è¯•å®Œæˆ
        run: |
          echo "âœ… æ–‡æ¡£æ„å»ºæµ‹è¯•å®Œæˆ"
          echo "ğŸ“ æäº¤: ${{ github.sha }}"
          echo "ğŸ”— åˆ†æ”¯: ${{ github.ref_name }}"
          echo "ğŸ’¡ æç¤º: åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾ (å¦‚ v1.2.0) ä»¥è§¦å‘æ­£å¼éƒ¨ç½²"
